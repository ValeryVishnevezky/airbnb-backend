import{u as I,a as _,b as C,r as m,j as a,c as P,d as R,l as k,s as L}from"./index-DsQbqFUw.js";import{m as U,n as T}from"./util.service-C-OYoz--.js";const h={query:v,get:B,post:W,put:z,remove:H,save:x};function v(e,c=500){var s=JSON.parse(localStorage.getItem(e))||[];return new Promise(t=>setTimeout(()=>t(s),c))}function B(e,c){return v(e).then(s=>{const t=s.find(r=>r._id===c);if(!t)throw new Error(`Get failed, cannot find entity with id: ${c} in: ${e}`);return t})}function W(e,c){return c._id=O(),v(e).then(s=>(s.unshift(c),x(e,s),c))}function z(e,c){return v(e).then(s=>{const t=s.findIndex(u=>u._id===c._id);if(t<0)throw new Error(`Update failed, cannot find entity with id: ${c._id} in: ${e}`);const r={...s[t],...c};return s.splice(t,1,r),x(e,s),r})}function H(e,c){return v(e).then(s=>{const t=s.findIndex(r=>r._id===c);if(t<0)throw new Error(`Remove failed, cannot find entity with id: ${c} in: ${e}`);s.splice(t,1),x(e,s)})}function x(e,c){localStorage.setItem(e,JSON.stringify(c))}function O(e=5){for(var c="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=0;t<e;t++)c+=s.charAt(Math.floor(Math.random()*s.length));return c}const g="stay",F={query:G,getById:E,save:q,remove:Y,addStayMsg:J,getDefaultFilter:K,getEmptyStay:V};window.cs=F;async function G(e={}){var c=await h.query(g);const{minCapacity:s,place:t,availableDates:r,label:u}=e;if(t&&(c=c.filter(n=>n.loc.city.toLowerCase().includes(t.toLowerCase())||n.loc.country.toLowerCase().includes(t.toLowerCase()))),r!=null&&r.start&&(r!=null&&r.end)){const n=new Date(r.start),l=new Date(r.end);c=c.filter(f=>f.availableDates.some(p=>{const b=new Date(`${p.month} ${p.start}`),j=new Date(`${p.month} ${p.end}`);return b<=n&&j>=l}))}return s&&(c=c.filter(n=>n.capacity>=s)),u&&(c=c.filter(n=>n.labels.some(l=>l===u))),c}function E(e){return h.get(g,e)}async function Y(e){await h.remove(g,e)}async function q(e){var c;if(e._id){const s={_id:e._id,name:e.name,summary:e.summary,imgUrls:e.imgUrls,loc:e.loc,price:e.price,capacity:e.capacity};c=await h.put(g,s)}else{const s={name:e.name,summary:e.summary,imgUrls:e.imgUrls,loc:e.loc,price:e.price,capacity:e.capacity,amenities:[],availableDates:[{month:"Nov",start:"20",end:"30"}],reviews:[],host:I.getLoggedinUser(),msgs:[]};c=await h.post(g,s)}return c}async function J(e,c){const s=await E(e),t={id:U(),by:I.getLoggedinUser(),txt:c};return s.msgs.push(t),await h.put(g,s),t}function K(){return{minCapacity:"",place:"",availableDates:{start:null,end:null},label:!1}}function V(){return{name:"",imgUrls:[null,null,null,null,null],price:"",summary:"",amenities:[],capacity:"",loc:{country:"",city:"",address:""}}}function X({stay:e,onShowDetails:c}){const s=_(),t=C(i=>i.stayModule.LikedStays),[r,u]=m.useState(0),[n,l]=m.useState(window.innerWidth<745),[f,p]=m.useState(t.includes(e._id));m.useEffect(()=>{window.addEventListener("resize",i);function i(){l(window.innerWidth<745)}return()=>{window.removeEventListener("resize",i)}},[]);function b(i){i.stopPropagation(),r!==0&&u(r-1)}function j(i){i.stopPropagation(),r!==e.imgUrls.length-1&&u(r+1)}function w(){const i=f?t.filter(d=>d!==e._id):[...t,e._id];s({type:"SET_LIKED_STAYS",LikedStays:i}),p(!f),localStorage.setItem("likedStays",JSON.stringify(i))}return a.jsx("div",{className:"carousel-container",children:a.jsxs("div",{className:"image-container",children:[r>0&&!n&&a.jsx("button",{className:"nav-button prev",onClick:i=>b(i),children:a.jsx("img",{src:"/svg/leftArrow.svg",alt:"Left arrow"})}),a.jsx("div",{className:"heart",onClick:w,children:a.jsx("img",{src:f?"/svg/redHeart.svg":"/svg/heart.svg",alt:"Heart"})}),a.jsx("div",{className:"images",children:e.imgUrls.map((i,d)=>a.jsx("img",{id:d,onClick:()=>c(e._id),src:i,style:{translate:`${-100*r}%`}},d))}),a.jsx("div",{className:"dots",children:e.imgUrls.map((i,d)=>a.jsx("span",{className:`dot ${d===r?"active":""}`},d))}),r<e.imgUrls.length-1&&!n&&a.jsx("button",{className:"nav-button next",onClick:i=>j(i),children:a.jsx("img",{src:"/svg/rightArrow.svg",alt:"Right arrow"})})]})})}function Q({stay:e}){const c=P();function s(t){c(`/stay/${t}`)}return a.jsxs("section",{className:"stay-preview-container",children:[a.jsx("div",{className:"imgCarousel",children:a.jsx(X,{stay:e,onShowDetails:s})}),a.jsxs("article",{onClick:()=>s(e._id),className:"stay-preview",children:[a.jsxs("p",{className:"stay-loc",children:[e.loc.city,", ",e.loc.country]}),a.jsx("p",{className:"stay-distance",children:e.roomType}),a.jsxs("p",{className:"stay-price",children:[a.jsxs("span",{children:["$",T(e.price)]})," night"]}),a.jsxs("div",{className:"stay-rating-container",children:[a.jsx("img",{className:"star",src:"/svg/star.svg",alt:"Star"}),e.reviews.length>0?a.jsxs(a.Fragment,{children:[a.jsx("p",{className:"rating-num",children:e.rating}),a.jsxs("p",{className:"ratings-amount",children:["(",e.reviews.length,")"]})]}):a.jsx("p",{children:"New"})]})]})]})}function Z({stays:e}){return a.jsx("section",{className:"stay-list-container",children:a.jsx("ul",{className:"stay-list",children:e.map(c=>a.jsx("li",{children:a.jsx(Q,{stay:c})},c._id))})})}const ee=[{name:"Beachfront",src:"https://a0.muscache.com/pictures/bcd1adc0-5cee-4d7a-85ec-f6730b0f8d0c.jpg"},{name:"Icons",src:"https://a0.muscache.com/im/pictures/mediaverse/category_icon/original/3e5243c8-4d15-4c6b-97e3-7ba2bb7bb880.png"},{name:"Cabins",src:"https://a0.muscache.com/pictures/732edad8-3ae0-49a8-a451-29a8010dcc0c.jpg"},{name:"Lakefront",src:"https://a0.muscache.com/pictures/677a041d-7264-4c45-bb72-52bff21eb6e8.jpg"},{name:"Surfing",src:"https://a0.muscache.com/pictures/957f8022-dfd7-426c-99fd-77ed792f6d7a.jpg"},{name:"Creative spaces",src:"https://a0.muscache.com/pictures/8a43b8c6-7eb4-421c-b3a9-1bd9fcb26622.jpg"},{name:"OMG!",src:"https://a0.muscache.com/pictures/c5a4f6fc-c92c-4ae8-87dd-57f1ff1b89a6.jpg"},{name:"Amazing views",src:"https://a0.muscache.com/pictures/3b1eb541-46d9-4bef-abc4-c37d77e3c21b.jpg"},{name:"Castles",src:"https://a0.muscache.com/pictures/1b6a8b70-a3b6-48b5-88e1-2243d9172c06.jpg"},{name:"Amazing pools",src:"https://a0.muscache.com/pictures/3fb523a0-b622-4368-8142-b5e03df7549b.jpg"},{name:"Mansions",src:"https://a0.muscache.com/pictures/78ba8486-6ba6-4a43-a56d-f556189193da.jpg"},{name:"Countryside",src:"https://a0.muscache.com/pictures/6ad4bd95-f086-437d-97e3-14d12155ddfe.jpg"},{name:"Islands",src:"https://a0.muscache.com/pictures/8e507f16-4943-4be9-b707-59bd38d56309.jpg"},{name:"Design",src:"https://a0.muscache.com/pictures/50861fca-582c-4bcc-89d3-857fb7ca6528.jpg"},{name:"Off-the-grid",src:"https://a0.muscache.com/pictures/9a2ca4df-ee90-4063-b15d-0de7e4ce210a.jpg"},{name:"Farms",src:"https://a0.muscache.com/pictures/aaa02c2d-9f0d-4c41-878a-68c12ec6c6bd.jpg"},{name:"Trending",src:"https://a0.muscache.com/pictures/3726d94b-534a-42b8-bca0-a0304d912260.jpg"},{name:"Treehouses",src:"https://a0.muscache.com/pictures/4d4a4eba-c7e4-43eb-9ce2-95e1d200d10e.jpg"},{name:"Luxe",src:"https://a0.muscache.com/pictures/c8e2ed05-c666-47b6-99fc-4cb6edcde6b4.jpg"},{name:"Top cities",src:"https://a0.muscache.com/pictures/ed8b9e47-609b-44c2-9768-33e6a22eccb2.jpg"},{name:"Tiny homes",src:"https://a0.muscache.com/pictures/3271df99-f071-4ecf-9128-eb2d2b1f50f0.jpg"},{name:"Tropical",src:"https://a0.muscache.com/pictures/ee9e2a40-ffac-4db9-9080-b351efc3cfc4.jpg"},{name:"Top of the world",src:"https://a0.muscache.com/pictures/248f85bf-e35e-4dc3-a9a1-e1dbff9a3db4.jpg"},{name:"Boats",src:"https://a0.muscache.com/pictures/687a8682-68b3-4f21-8d71-3c3aef6c1110.jpg"},{name:"Historical homes",src:"https://a0.muscache.com/pictures/33dd714a-7b4a-4654-aaf0-f58ea887a688.jpg"},{name:"Play",src:"https://a0.muscache.com/pictures/f0c5ca0f-5aa0-4fe5-b38d-654264bacddf.jpg"},{name:"Earth homes",src:"https://a0.muscache.com/pictures/d7445031-62c4-46d0-91c3-4f29f9790f7a.jpg"},{name:"Ski-in/out",src:"https://a0.muscache.com/pictures/757deeaa-c78f-488f-992b-d3b1ecc06fc9.jpg"},{name:"National parks",src:"https://a0.muscache.com/pictures/c0a24c04-ce1f-490c-833f-987613930eca.jpg"},{name:"Houseboats",src:"https://a0.muscache.com/pictures/c027ff1a-b89c-4331-ae04-f8dee1cdc287.jpg"},{name:"Desert",src:"https://a0.muscache.com/pictures/a6dd2bae-5fd0-4b28-b123-206783b5de1d.jpg"},{name:"A-frames",src:"https://a0.muscache.com/pictures/1d477273-96d6-4819-9bda-9085f809dad3.jpg"},{name:"Rooms",src:"https://a0.muscache.com/pictures/7630c83f-96a8-4232-9a10-0398661e2e6f.jpg"},{name:"Vineyards",src:"https://a0.muscache.com/pictures/60ff02ae-d4a2-4d18-a120-0dd274a95925.jpg"},{name:"Arctic",src:"https://a0.muscache.com/pictures/8b44f770-7156-4c7b-b4d3-d92549c8652f.jpg"},{name:"Chef's kitchens",src:"https://a0.muscache.com/pictures/1d477273-96d6-4819-9bda-9085f809dad3.jpg"},{name:"Caves",src:"https://a0.muscache.com/pictures/4221e293-4770-4ea8-a4fa-9972158d4004.jpg"},{name:"Domes",src:"https://a0.muscache.com/pictures/89faf9ae-bbbc-4bc4-aecd-cc15bf36cbca.jpg"},{name:"Camping",src:"https://a0.muscache.com/pictures/ca25c7f3-0d1f-432b-9efa-b9f5dc6d8770.jpg"},{name:"New",src:"https://a0.muscache.com/pictures/c0fa9598-4e37-40f3-b734-4bd0e2377add.jpg"},{name:"Bed & breakfast",src:"https://a0.muscache.com/pictures/5ed8f7c7-2e1f-43a8-9a39-4edfc81a3325.jpg"},{name:"Towers",src:"https://a0.muscache.com/pictures/d721318f-4752-417d-b4fa-77da3cbc3269.jpg"},{name:"Containers",src:"https://a0.muscache.com/pictures/0ff9740e-52a2-4cd5-ae5a-94e1bfb560d6.jpg"},{name:"Skiing",src:"https://a0.muscache.com/pictures/c8bba3ed-34c0-464a-8e6e-27574d20e4d2.jpg"},{name:"Windmills",src:"https://a0.muscache.com/pictures/5cdb8451-8f75-4c5f-a17d-33ee228e3db8.jpg"},{name:"Dammusi",src:"https://a0.muscache.com/pictures/c9157d0a-98fe-4516-af81-44022118fbc7.jpg"},{name:"Riads",src:"https://a0.muscache.com/pictures/7ff6e4a1-51b4-4671-bc9a-6f523f196c61.jpg"},{name:"Cycladic homes",src:"https://a0.muscache.com/pictures/e4b12c1b-409b-4cb6-a674-7c1284449f6e.jpg"},{name:"Ryokans",src:"https://a0.muscache.com/pictures/827c5623-d182-474a-823c-db3894490896.jpg"},{name:"Barns",src:"https://a0.muscache.com/pictures/f60700bc-8ab5-424c-912b-6ef17abc479a.jpg"},{name:"Grand pianos",src:"https://a0.muscache.com/pictures/8eccb972-4bd6-43c5-ac83-27822c0d3dcd.jpg"},{name:"Yurts",src:"https://a0.muscache.com/pictures/4759a0a7-96a8-4dcd-9490-ed785af6df14.jpg"},{name:"Shepherd's huts",src:"https://a0.muscache.com/pictures/747b326c-cb8f-41cf-a7f9-809ab646e10c.jpg"},{name:"Adapted",src:"https://a0.muscache.com/pictures/e22b0816-f0f3-42a0-a5db-e0f1fa93292b.jpg"},{name:"Hanoks",src:"https://a0.muscache.com/pictures/51f5cf64-5821-400c-8033-8a10c7787d69.jpg"},{name:"Campers",src:"https://a0.muscache.com/pictures/31c1d523-cc46-45b3-957a-da76c30c85f9.jpg"},{name:"Golfing",src:"https://a0.muscache.com/pictures/6b639c8d-cf9b-41fb-91a0-91af9d7677cc.jpg"},{name:"Lake",src:"https://a0.muscache.com/pictures/a4634ca6-1407-4864-ab97-6e141967d782.jpg"},{name:"Casas particulares",src:"https://a0.muscache.com/pictures/251c0635-cc91-4ef7-bb13-1084d5229446.jpg"},{name:"Trulli",src:"https://a0.muscache.com/pictures/33848f9e-8dd6-4777-b905-ed38342bacb9.jpg"},{name:"Beach",src:"https://a0.muscache.com/pictures/10ce1091-c854-40f3-a2fb-defc2995bcaf.jpg"},{name:"Minsus",src:"https://a0.muscache.com/pictures/48b55f09-f51c-4ff5-b2c6-7f6bd4d1e049.jpg"}];function ce({onSetFilter:e,filterBy:c}){const[s,t]=R(),[r,u]=m.useState(s.get("category")),[n,l]=m.useState(!1),[f,p]=m.useState(!1),[b,j]=m.useState(0),[w,i]=m.useState(window.innerWidth<745),d=m.useRef(null);m.useEffect(()=>{window.addEventListener("scroll",M),window.addEventListener("resize",$)},[]);function $(){i(window.innerWidth<745)}function M(){p(window.scrollY>0)}function N(o){const S=d.current.clientWidth*.5*o,y=d.current.scrollLeft+S,A=Math.ceil(y+d.current.clientWidth)>=d.current.scrollWidth;d.current.scrollLeft=y,j(y),l(A)}function D(o){o===r&&(o=""),e({...c,label:o}),u(o),t({category:o})}return a.jsxs("div",{className:`categories-outer-container
            ${f?"cat-sticky":"cat-not-sticky"} `,children:[b>0&&!w&&a.jsx("button",{className:"cat-button prev",onClick:()=>N(-1),children:a.jsx("img",{src:"/svg/leftArrow.svg",alt:"Left arrow"})}),a.jsx("section",{ref:d,className:"categories-inner-container",children:ee.map((o,S)=>a.jsxs("div",{onClick:()=>D(o.name),className:`category ${o.name} ${r===o.name?"selected":""} `,id:S,children:[a.jsx("img",{src:o.src,alt:o.name}),a.jsx("span",{children:o.name})]},o.name))}),!n&&!w&&a.jsx("button",{className:"cat-button next",onClick:()=>N(1),children:a.jsx("img",{src:"/svg/rightArrow.svg",alt:"Right arrow"})})]})}function te(){const e=_(),c=C(n=>n.stayModule.stays),s=C(n=>n.stayModule.filterBy),t=m.useRef(null),r=m.useRef(!1);console.log(c.length),m.useEffect(()=>{k({...s,page:0})},[s.place,s.minCapacity,s.availableDates,s.label]),m.useEffect(()=>{if(!t.current)return;const n=new IntersectionObserver(l=>{if(l[0].isIntersecting&&!r.current){r.current=!0;const p=s.page+1;k({...s,page:p}).finally(()=>{r.current=!1}),e(L({...s,page:p}))}});return n.observe(t.current),()=>n.disconnect()},[s]);function u(n){e(L({...s,...n,page:0}))}return a.jsxs("section",{className:"stay-index",children:[a.jsx(ce,{filterBy:s,onSetFilter:u}),a.jsx(Z,{stays:c}),a.jsx("div",{ref:t,style:{height:"50px"}})]})}export{te as default};
