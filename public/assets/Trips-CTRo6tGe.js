import{b,r as i,c as w,m as I,j as s,e as L}from"./index-B3Qt7UQK.js";import{n as T}from"./util.service-C-OYoz--.js";import{l as M}from"./order.actions-OS0PIJFA.js";function O({selectedStayId:c,stays:p,orders:h,setTripDetailsOpen:y}){b(t=>t.userModule.user);const[d,x]=i.useState([]),[m,g]=i.useState({}),[f,N]=i.useState({}),v=w(),[S,e]=i.useState({x:0,y:0}),[n,j]=i.useState(!0);i.useEffect(()=>{console.log(p);const t=Object.values(p).find(r=>r._id===c);g(t);const o=Object.values(h).find(r=>r.stayId===c);x(o),o&&I.getById(o.hostId).then(r=>N(r)),j(!1)},[c,p,h]);function a(t){const o=t.currentTarget,r=o.getBoundingClientRect(),D=(t.clientX-r.left)/r.width*100,C=(t.clientY-r.top)/r.height*100;o.style.setProperty("--mouse-x",`${D}%`),o.style.setProperty("--mouse-y",`${C}%`),e({x:D,y:C})}function l(t){return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}function u(t){v(`/stay/${t}`)}return n?s.jsx("div",{children:"Loading..."}):s.jsx("div",{className:"trip-details",onClick:()=>y(!1),children:s.jsxs("div",{className:"trip-details-modal",children:[s.jsxs("div",{className:"trip-details-stay-info",children:[s.jsx("div",{className:"trip-details-img",children:s.jsx("img",{src:m.imgUrls[0],alt:""})}),s.jsxs("div",{className:"trip-details-info",children:[s.jsx("h1",{children:m.name}),s.jsxs("p",{children:["Adults ",s.jsx("span",{children:d.guests.adults})]}),s.jsxs("p",{children:["Kids ",s.jsx("span",{children:d.guests.kids})]}),s.jsxs("p",{children:["Country ",s.jsx("span",{children:m.country})]}),s.jsxs("p",{children:["Dates"," ",s.jsxs("span",{className:"span-dates",children:[l(d.startDate)," - ",l(d.endDate)]})]}),s.jsxs("p",{children:["Total price"," ",s.jsxs("span",{className:"span-price",children:["$",T(d.totalPrice)]})]})]})]}),s.jsxs("div",{className:"trip-details-bottom",children:[s.jsx("div",{className:"trip-details-host-info",children:s.jsxs("div",{className:"trip-details-host-info-box",children:[s.jsx("img",{src:f.imgUrl,alt:""}),s.jsxs("h1",{children:["Host ",f.fullname]})]})}),s.jsx("button",{onClick:()=>u(m._id),onMouseMove:a,children:"Stay details"})]})]})})}function _(){const c=b(e=>e.userModule.user),[p,h]=i.useState(!1),[y,d]=i.useState(null),[x,m]=i.useState([]),[g,f]=i.useState([]),[N,v]=i.useState(!0);i.useEffect(()=>{c!=null&&c._id&&M(c._id).then(e=>{const n=e.sort((a,l)=>new Date(l.startDate)-new Date(a.startDate));m(n);const j=e.map(a=>a.stayId);Promise.all(j.map(a=>L.getById(a))).then(a=>{const l=a.reduce((u,t)=>(u[t._id]=t,u),{});f(l),v(!1)})})},[c]);function S(e){d(e),h(!0)}return N?s.jsx("div",{children:"Loading..."}):s.jsxs("div",{className:"trips-page",children:[s.jsx("h1",{children:"Your trips"}),s.jsx("div",{className:"user-trips",children:x.length>0?x.map(e=>{var l,u;const n=g[e.stayId],j=((l=n==null?void 0:n.imgUrls)==null?void 0:l[0])||"",a=(n==null?void 0:n.name)||"";return s.jsxs("div",{className:"user-trip",onClick:()=>S(e.stayId),children:[s.jsxs("div",{className:"user-trip-top",children:[s.jsx("img",{src:j,alt:a,className:"trip-image"}),s.jsxs("h3",{className:"trip-name",children:[a.substring(0,27),"..."]}),s.jsxs("h4",{className:"trip-dates",children:[new Date(e.startDate).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"}),s.jsx("span",{children:" - "}),new Date(e.endDate).toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"})]})]}),s.jsxs("div",{className:"user-trip-bottom",children:[s.jsxs("p",{className:"user-trip-price",children:["Total $",e.totalPrice]}),s.jsx("p",{className:"user-trip-status",children:s.jsx("span",{className:`status ${((u=e.status)==null?void 0:u.toLowerCase())||"unknown"}`,children:e.status.charAt(0).toUpperCase()+e.status.slice(1).toLowerCase()})})]})]},e._id)}):s.jsx("p",{children:"No trips yet"})}),p&&s.jsx(O,{selectedStayId:y,stays:g,orders:x,setTripDetailsOpen:h})]})}export{_ as default};
